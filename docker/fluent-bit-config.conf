[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        off
    Parsers_File  /fluent-bit/etc/parsers.conf

[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*-json.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    # 启用 Docker 模式，自动添加容器元数据
    Docker_Mode       On

[FILTER]
    Name                grep
    Match               docker.*
    # 只保留 areyouok 相关的容器日志
    # Docker_Mode 会添加 container_name 字段
    Regex               container_name areyouok-.*

[FILTER]
    Name                record_modifier
    Match               docker.*
    # 添加默认的 level 字段
    Record              level info

[OUTPUT]
    Name  loki
    Match docker.*
    Host  loki
    Port  3100
    # Fluent Bit 4.2.0 使用 Labels 方式配置标签
    # Docker_Mode 会提供 container_name 字段
    Labels job=$container_name,container=$container_name,level=$level
    Auto_kubernetes_labels off
